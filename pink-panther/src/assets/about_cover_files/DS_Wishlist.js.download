function ToggleWishList(ProductID, UserID, AnonymousTrueFalse) {
  var ActionResult;
  var CurrentListCountText;
  var NewListCountText;
  var CountAsText;
  $.ajax({
    type: "POST",
    crossDomain: true,
    url: "https://www.thediamondstore.co.uk/wishlist/_WishListFunctions.cfm",
    async: false,
    data: {
      Action: 'ToggleWishList',
      ProductID: ProductID,
      UserID: UserID,
      Anonymous: AnonymousTrueFalse
    },
    cache: false,
    success: function(data) {
      SelectedItem = "#wish" + ProductID;
      ActionResult =  data.trim();
      if (ActionResult == "1") {
        $(SelectedItem).toggleClass("selected");
        CountAsText = $("#WishListCount").text();
        if (CountAsText == '') {
          CurrentListCountText = 0;
          $("#WishListCount").removeClass("goods");
        } else {
          CurrentListCountText = parseInt($("#WishListCount").text());
          $("#WishListCount").addClass("goods");
        }
        NewListCountText = CurrentListCountText + 1;
        $("#WishListCount").text(NewListCountText);
      } else {
        $(SelectedItem).toggleClass("selected");
        CurrentListCountText = parseInt($("#WishListCount").text())
        NewListCountText = CurrentListCountText - 1;
        if (NewListCountText == 0) {
          NewListCountText = "0";
          $("#WishListCount").removeClass('goods');
        }
        $("#WishListCount").text(NewListCountText);
      }
    },
    error: function(jqxhr, status, exception) {
      console.log('Exception:', exception);
    }
  });
}



function ShowWishListTable() {
  console.log("In ShowWishListTable AJAX Function");
    var xxx = 1;
    $.ajax({
        url: 'https://www.thediamondstore.co.uk/wishlist/_WishListItems.cfm',
        type: 'get',
        success: function(data) {
            var response = data;
            if (response.length > 0) {
                $("#WishListContainer").html(data);
            }

        }
    });
}

function DeleteWishListItem(InWish_ID) {
  var UserResponse = confirm("Are you certain that you want to delete this item from your Wish List?");
  if (UserResponse == true) {
    var ActionResult;

    $.ajax({
      type: "POST",
      url: "https://www.thediamondstore.co.uk/wishlist/_WishListFunctions.cfm",
      async: false,
      data: {
        Action: 'DeleteWishListItem',
        Wish_ID: InWish_ID
      },
      cache: false,
      success: function(data) {
        ActionResult = data.trim();

        if (ActionResult == "1") {
          ShowWishListTable();
          $("#StatusMessage").text('Item was removed');
          var ThisCurrentWishListCount = parseInt($("#WishListCount").text());
          ThisCurrentWishListCount = ThisCurrentWishListCount - 1;
          if (ThisCurrentWishListCount == 0) {
            ThisCurrentWishListCount = '0';
            $('#WishListCount').removeClass('goods');
          }
          $('#WishListCount').text(ThisCurrentWishListCount);
        } else {
          $("#StatusMessage").text('')
        }
      }
    });
  }
}

function DeleteAllWishListItemsByUserID() {
  var UserResponse = confirm("Are you certain that you want to delete all your Wish List items?");
  if (UserResponse == true) {
    var ActionResult;

    $.ajax({
      type: "POST",
      url: "https://www.thediamondstore.co.uk/wishlist/_WishListFunctions.cfm",
      async: false,
      data: {
        Action: 'RemoveAllCustomerWishListItems'
      },
      cache: false,
      success: function(data) {
        ActionResult = data.trim();

        if (ActionResult == "1") {
          ShowWishListTable();
          $("#StatusMessage").text('All wishlist items were removed');
            let ThisCurrentWishListCount = '0';
            $('#WishListCount').removeClass('goods');
            $('#WishListCount').text(ThisCurrentWishListCount);
            $('#RemoveAllWishListItems').hide();

          }
      }
    });
  }
}


function DeleteWishListItemWithoutConfirmation(InWish_ID) {
    var ActionResult;
    $.ajax({
      type: "POST",
      url: "https://www.thediamondstore.co.uk/wishlist/_WishListFunctions.cfm",
      async: false,
      data: {
        Action: 'DeleteWishListItem',
        Wish_ID: InWish_ID
      },
      cache: false,
      success: function(data) {
        ActionResult = data.trim();
      }
    });
}


function AddToBasket(IntProductID, IntWishID) {
  DeleteWishListItemWithoutConfirmation(IntWishID);
  window.location.href = 'https://www.thediamondstore.co.uk/basket.cfm?Product_ID=' + IntProductID + '&Quantity=1';
}



function getRandomNumber(){
    return Math.floor(Math.random()*(9999-1000+1)+1000);
}

function ClearAnonymousWishList(){
    localStorage.removeItem('AnonymousWishlist');
}

function CheckAnonymousWishListExists(){
    const WishList = localStorage.getItem('AnonymousWishlist');
    if (WishList) {
      if (WishList.length > 0) {
        return 1;
      } else {
        return 0;
      }
    } else {
        return 0;
    }
}

function StoreAnonymousWishList() {
    ClearAnonymousWishList();
    var ThisRandomNumber = getRandomNumber();
    var ActionResult;
    $.ajax({
      type: "POST",
      url: "https://www.thediamondstore.co.uk/wishlist/_WishListFunctions.cfm?v=" + ThisRandomNumber,
      async: false,
      data: {
        Action: 'StoreAnonymousWishList'
      },
      cache: false,
      success: function(data) {
        ActionResult = data.trim();
        let length = ActionResult.length;
        if (length > 1) {
          localStorage.setItem('AnonymousWishlist', ActionResult);
        }
      }
    });
}

function RecoverStoredAnonymousWishlist() {
  var ListOfProductIDs = "";
  if (CheckAnonymousWishListExists() == 1) {
    ListOfProductIDs = localStorage.getItem('AnonymousWishlist');

  }
}



function SendWishListEmail() {
    var ActionResult;
    var StrSendToName = $("#SendToName").val();
    var StrSendToEmail = $("#SendToEmail").val();
    if (StrSendToName == "Your name*" || StrSendToEmail == "our email*") {
      $("#EmailStatusMessage").text("You must enter a valid Email and Name");
      return;
    }
    $.ajax({
      type: "POST",
      url: "https://www.thediamondstore.co.uk/wishlist/_WishListFunctions.cfm",
      async: false,
      data: {
        Action: 'SendWishListEmail',
        SendName: StrSendToName,
        SendEmail: StrSendToEmail
      },
      cache: false,
      success: function(data) {
        ActionResult = data.trim();
        $("#EmailStatusMessage").text(ActionResult);
      }
    });
}

// This is for SLi wishlist icons
function ToggleWishListNew(ProductID) {
  var ActionResult;
  var CurrentListCountText;
  var NewListCountText;
  var CountAsText;
  $.ajax({
    type: "POST",
    url: "https://www.thediamondstore.co.uk/wishlist/_WishListFunctions.cfm",
    async: false,
    data: {
      Action: 'ToggleWishListNew',
      ProductID: ProductID
    },
    cache: false,
    success: function(data) {
      SelectedItem = "#wish" + ProductID;
      ActionResult =  data.trim();
      if (ActionResult == "") {
        return;
      }
      if (ActionResult == "1") {
        $(SelectedItem).toggleClass("selected");
        CountAsText = $("#WishListCount").text();
        if (CountAsText == '') {
          CurrentListCountText = 0;
          $("#WishListCount").removeClass("goods");
        } else {
          CurrentListCountText = parseInt($("#WishListCount").text());
          $("#WishListCount").addClass("goods");
        }
        NewListCountText = CurrentListCountText + 1;
        $("#WishListCount").text(NewListCountText);
      } else {
        $(SelectedItem).toggleClass("selected");
        CurrentListCountText = parseInt($("#WishListCount").text())
        NewListCountText = CurrentListCountText - 1;
        if (NewListCountText == 0) {
          NewListCountText = "0";
          $("#WishListCount").removeClass('goods');
        }
        $("#WishListCount").text(NewListCountText);
      }
    },
    error: function(jqxhr, status, exception) {
      console.log('Exception:', exception);
    }
  });
}
function FixSLIWishlistPagesNew() {
  $.ajax({
    url: 'https://www.thediamondstore.co.uk/wishlist/_WishListFunctions.cfm?CB=200',
    type: 'get',
    async: false,
    data: {
      Action: 'TestGetSLIWishListItems'
    },
    success: function(data) {
      var ThisCSVList = data.trim();
      if (ThisCSVList.length > 0) {
        console.log(ThisCSVList);
        $("#WishListCount").toggleClass("goods");
        const ProductArray = ThisCSVList.split(",");
        let ArrayLength = ProductArray.length;
        console.log('There are '+ ArrayLength + ' Items in the wishlist');
        $("#WishListCount").text(ArrayLength);
        for (let i = 0; i < ArrayLength; i++) {
          let SelectedItem = "#wish" + ProductArray[i];
          $(SelectedItem).addClass('selected');
        }
      }
    }
  });
}

// This is the SLi fix for the basket
function FixSLIBasketCount() {
  var ThisRandomNumber = getRandomNumber();
  $.ajax({
    url: "https://www.thediamondstore.co.uk/wishlist/_WishListFunctions.cfm?v=" + ThisRandomNumber,
    type: 'get',
    async: false,
    data: {
      Action: 'GetBasketCount'
    },
    success: function(data) {
      var ThisCount = data.trim();
      if (ThisCount > 0) {
        $("#BasketCount").addClass("goods");
        $("#BasketCount").text(ThisCount);
      }
    }
  });
}
